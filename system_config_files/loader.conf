# FreeBSD 14 ThinkPad T480 /boot/loader.conf configuration
# Kernel modules and system parameters loaded at boot time

# ============================================================================
# CRYPTOGRAPHY AND SECURITY
# ============================================================================

# Load AES-NI hardware acceleration module for encryption/decryption
aesni_load="YES"

# Load GELI (GEOM Eli) disk encryption framework
geom_eli_load="YES"

# Load cryptodev framework for hardware crypto acceleration
cryptodev_load="YES"

# ============================================================================
# DISK AND STORAGE CONFIGURATION
# ============================================================================

# Disable disk identifier labels in /dev (reduces clutter)
kern.geom.label.disk_ident.enable="0"

# Disable GPT ID labels in /dev (use more readable names instead)
kern.geom.label.gptid.enable="0"

# Load ZFS filesystem kernel module
zfs_load="YES"

# Load FUSE filesystem support for userspace filesystems
fusefs_load="YES"

# ============================================================================
# NETWORK DRIVERS
# ============================================================================

# Load Intel iwm wireless driver (for 7000/8000/9000 series cards)
if_iwm_load="YES"

# Load firmware for Intel 8265 wireless card
iwm8265fw_load="YES"

# Load Intel em ethernet driver (for PRO/1000 network cards)
if_em_load="YES"

# ============================================================================
# GRAPHICS AND DISPLAY
# ============================================================================

# Load Intel i915 graphics driver with KMS (Kernel Mode Setting)
i915kms_load="YES"

# Load ACPI video extensions for laptop display control
acpi_video_load="YES"

# ============================================================================
# GRAPHICS DRIVER TUNING
# ============================================================================

# Commented out: Intel graphics power management settings
# These can improve battery life but may cause stability issues
hw.i915kms.enable_dc=2    # Display C-states (2=DC5/DC6, 1=DC3/DC5, 0=disabled)
hw.i915kms.enable_fbc=1   # Frame Buffer Compression (saves power/bandwidth)

# ============================================================================
# LAPTOP/THINKPAD SPECIFIC
# ============================================================================

# Load IBM/Lenovo ThinkPad ACPI extras (Fn keys, thermal, etc.)
acpi_ibm_load="YES"

# Enable Synaptics touchpad support
hw.psm.synaptics_support="1"

# ============================================================================
# POWER AND THERMAL MANAGEMENT
# ============================================================================

# Load CPU frequency scaling framework
cpufreq_load="YES"

# Load Intel CPU temperature monitoring
coretemp_load="YES"

# Place unclaimed PCI devices in low power state (power saving)
# 0=no power management, 1=conservative, 2=aggressive, 3=most aggressive
hw.pci.do_power_nodriver=3

# ============================================================================
# AUDIO SUPPORT
# ============================================================================

# Load High Definition Audio (HDA) sound driver
snd_hda_load="YES"

# ============================================================================
# VIRTUALIZATION AND USERSPACE DRIVERS
# ============================================================================

# Load CUSE (Character device in USErspace) framework
# Required for some userspace drivers and applications
cuse_load="YES"

# ============================================================================
# MEMORY MANAGEMENT AND ZFS TUNING
# ============================================================================

# Set kernel memory size to 4GB (for ZFS and system use)
vm.kmem_size="4G"

# Set maximum kernel memory size to 4GB
vm.kmem_size_max="4G"

# Limit ZFS ARC (cache) to 4GB to leave RAM for other processes
# This prevents ZFS from consuming all available memory
vfs.zfs.arc_max="4G"

# ============================================================================
# INTER-PROCESS COMMUNICATION (IPC) SETTINGS
# ============================================================================

# Maximum shared memory segments per process
kern.ipc.shmseg=1024

# Maximum number of shared memory identifiers system-wide
kern.ipc.shmmni=1024

# ============================================================================
# NOTES AND RECOMMENDATIONS
# ============================================================================
# 1. Memory settings assume 8GB+ total RAM - adjust accordingly
# 2. ZFS ARC + kernel memory should not exceed ~50-75% of total RAM
# 3. The i915kms driver loading here may conflict with kld_list in rc.conf
# 4. Power management setting (hw.pci.do_power_nodriver=3) is aggressive
#    and may cause issues with some hardware - reduce if problems occur
# 5. iwm8265fw is specific to Intel 8265 cards - adjust for your hardware