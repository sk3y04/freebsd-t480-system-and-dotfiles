
# FreeBSD 14 ThinkPad T480 /boot/loader.conf configuration
# Kernel modules and system parameters loaded at boot time

# ============================================================================
# CRYPTOGRAPHY AND SECURITY
# ============================================================================

# Load AES-NI hardware acceleration module for encryption/decryption
aesni_load="YES"

# Load GELI (GEOM Eli) disk encryption framework
geom_eli_load="YES"

# Load cryptodev framework for hardware crypto acceleration
cryptodev_load="YES"

# ============================================================================
# DISK AND STORAGE CONFIGURATION
# ============================================================================

# Disable disk identifier labels in /dev (reduces clutter)
kern.geom.label.disk_ident.enable="0"

# Disable GPT ID labels in /dev (use more readable names instead)
kern.geom.label.gptid.enable="0"

# Load ZFS filesystem kernel module
zfs_load="YES"

# =========================================================================
# NETWORK DRIVERS
# =========================================================================
# Network modules now load via rc.conf kld_list

# =========================================================================
# GRAPHICS DRIVER TUNING
# =========================================================================
# Commented out: Intel graphics power management settings
# These can improve battery life but may cause stability issues
hw.i915kms.enable_dc=2    # Display C-states (2=DC5/DC6, 1=DC3/DC5, 0=disabled)
hw.i915kms.enable_fbc=1   # Frame Buffer Compression (saves power/bandwidth)

# =========================================================================
# LAPTOP/THINKPAD SPECIFIC
# =========================================================================
# ThinkPad ACPI extras now load via rc.conf kld_list
hw.psm.synaptics_support="1"

# =========================================================================
# POWER AND THERMAL MANAGEMENT
# =========================================================================
# Place unclaimed PCI devices in low power state (power saving)
# 0=no power management, 1=conservative, 2=aggressive, 3=most aggressive
hw.pci.do_power_nodriver=3

# =========================================================================
# AUDIO SUPPORT
# =========================================================================
# Audio modules now load via rc.conf kld_list
# Slightly larger HDA buffer to tame occasional pops without huge latency hit
hw.snd.latency="4"

# =========================================================================
# VIRTUALIZATION AND USERSPACE DRIVERS
# =========================================================================
# Virtualization modules now load via rc.conf kld_list

# =========================================================================
# MEMORY MANAGEMENT AND ZFS TUNING
# =========================================================================
# Tuned for 16GB RAM: reserve 4GB for the kernel to keep ZFS stable on large pools
vm.kmem_size="4G"

# Cap kernel memory growth so it can't starve userland when ZFS is busy
vm.kmem_size_max="4G"

# Limit ARC to 4GB so the desktop retains plenty of free RAM
vfs.zfs.arc_max="4G"

# =========================================================================
# INTER-PROCESS COMMUNICATION (IPC) SETTINGS
# =========================================================================
# Raise per-process shared-memory segments for modern browsers/desktops
kern.ipc.shmseg=1024

# Lift system-wide shared-memory identifiers to avoid hitting legacy limits
kern.ipc.shmmni=1024

# ============================================================================
# NOTES 
# ============================================================================
# 1. Memory settings assume 8GB+ total RAM - adjust accordingly
# 2. ZFS ARC + kernel memory should not exceed ~50-75% of total RAM
# 3. The i915kms driver now loads via rc.conf kld_list; ensure this file only
#    provides tunables the driver needs at boot
# 4. Power management setting (hw.pci.do_power_nodriver=3) is aggressive
#    and may cause issues with some hardware - reduce if problems occur
# 5. iwm8265fw is specific to Intel 8265 cards - adjust for your hardware