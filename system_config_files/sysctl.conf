# FreeBSD 14 ThinkPad T480 /etc/sysctl.conf configuration
# This file is read when going to multi-user and its contents piped through
# 'sysctl' to adjust kernel values. See 'man 5 sysctl.conf' for details.

# ============================================================================
# SECURITY SETTINGS
# ============================================================================

# Prevent users from seeing information about processes running under other UIDs
# This hides other users' processes in ps, top, etc. for privacy/security
security.bsd.see_other_uids=0

# Prevent users from seeing information about processes running under other GIDs
# Similar to above but for group-based process visibility
security.bsd.see_other_gids=0

# Prevent unprivileged users from reading kernel message buffer (dmesg)
# Stops regular users from accessing potentially sensitive kernel messages
security.bsd.unprivileged_read_msgbuf=0

# Prevent unprivileged users from debugging processes they don't own
# Blocks ptrace/debugging system calls for enhanced security
security.bsd.unprivileged_proc_debug=0

# ============================================================================
# ZFS FILESYSTEM TUNING
# ============================================================================

# Set minimum automatic ashift value to 12 (4KB sectors)
# Forces ZFS to align to 4KB boundaries, optimal for modern drives
# Improves performance on Advanced Format drives and SSDs
vfs.zfs.min_auto_ashift=12

# ============================================================================
# SCHEDULER AND PERFORMANCE TUNING
# ============================================================================

# Set scheduler preemption threshold (lower = more responsive, higher = more throughput)
# Default is usually 80, 224 reduces context switching for better throughput
kern.sched.preempt_thresh=224

# Increase maximum number of open files system-wide
# Default is often too low for busy servers or development systems
# Helps prevent "too many open files" errors
kern.maxfiles=200000

# ============================================================================
# INTER-PROCESS COMMUNICATION (IPC) SETTINGS
# ============================================================================

# Maximum size of a single shared memory segment (64MB)
# Useful for applications that need large shared memory areas
kern.ipc.shmmax=67108864

# Total amount of shared memory pages available system-wide
# 32768 pages * page_size = total shared memory pool
kern.ipc.shmall=32768

# Commented out (enabled in /boot/loder.conf): Maximum shared memory segments per process
#kern.ipc.shmseg=1024

# Commented out (enabled in /boot/loader.conf): Maximum number of shared memory identifiers system-wide
#kern.ipc.shmmni=1024

# ============================================================================
# NETWORK PERFORMANCE TUNING
# ============================================================================

# Set TCP congestion control algorithm to CUBIC
# CUBIC is more aggressive than default and better for high-bandwidth networks
net.inet.tcp.cc.algorithm=cubic

# Increase maximum TCP send buffer size to 16MB
# Improves performance on high-bandwidth, high-latency networks
net.inet.tcp.sendbuf_max=16777216

# Increase maximum TCP receive buffer size to 16MB
# Matches send buffer for balanced high-performance networking
net.inet.tcp.recvbuf_max=16777216

# ============================================================================
# POWER MANAGEMENT
# ============================================================================

# Set laptop lid close action to Suspend-to-RAM (S3)
# S1=light sleep, S3=suspend-to-RAM, S4=hibernate, S5=shutdown
hw.acpi.lid_switch_state=S3

# ============================================================================
# USER INTERFACE AND USABILITY
# ============================================================================

# Disable system bell/beep in virtual terminals
# Prevents annoying console beeps during tab completion, etc.
kern.vt.enable_bell=0

# Allow regular users to mount filesystems they own
# Required for FUSE filesystems and user-mounted devices
# Security note: only allows mounting on paths the user owns
vfs.usermount=1

# ============================================================================
# NOTES 
# ============================================================================
# 1. Security settings are quite restrictive - good for multi-user systems
# 2. Network buffer increases assume adequate RAM - reduce if memory constrained
# 3. ZFS ashift=12 is optimal for modern drives but can't be changed after pool creation
# 4. IPC settings may need adjustment based on specific application requirements
# 5. CUBIC congestion control is better for fast networks but may not help on slow connections